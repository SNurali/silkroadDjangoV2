# –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –ë–∏–∑–Ω–µ—Å-–õ–æ–≥–∏–∫–∏ –∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Project SilkRoad

–ü—Ä–æ–≤–µ–¥—è –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –∏ —Å—Ä–∞–≤–Ω–∏–≤ –µ–µ —Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º "Enterprise Architecture Document", —è –≤—ã—è–≤–∏–ª –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –º–µ–∂–¥—É –∑–∞—è–≤–ª–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π.

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ —ç—Ç–∞–ø–∞–º.

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ (GAP Analysis)

### 1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ë–∞–∑ –î–∞–Ω–Ω—ã—Ö (–≠–¢–ê–ü 5)
*   **–ó–∞—è–≤–ª–µ–Ω–æ:** PostgreSQL (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏) + ClickHouse (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞) + Kafka (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è).
*   **–ü–æ —Ñ–∞–∫—Ç—É:** –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **MySQL** (`mysqlclient`, `PyMySQL` –≤ `requirements.txt`).
*   **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `ClickHouse`, `Kafka` –∏ –¥—Ä–∞–π–≤–µ—Ä—ã –¥–ª—è –Ω–∏—Ö. –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã). –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –∏ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (–≠–¢–ê–ü 6)
*   **–ó–∞—è–≤–ª–µ–Ω–æ:** Redis (–∫—ç—à, —Å–µ—Å—Å–∏–∏) + Celery (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏: PDF, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è).
*   **–ü–æ —Ñ–∞–∫—Ç—É:** –í `requirements.txt` **–Ω–µ—Ç** `celery`, `redis` –∏–ª–∏ `django-redis`.
*   **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫:** –í—Å–µ –∑–∞–¥–∞—á–∏ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ E-mehmon, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤, –æ—Ç–ø—Ä–∞–≤–∫–∞ email) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ. –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ–ª–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ –ª—é–±–æ–π –∑–∞–¥–µ—Ä–∂–∫–µ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö API (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ E-mehmon "–¥—É–º–∞–µ—Ç" 10 —Å–µ–∫—É–Ω–¥, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –∂–¥–∞—Ç—å 10 —Å–µ–∫—É–Ω–¥).
*   **–†–∏—Å–∫:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π.

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–∏–∑–Ω–µ—Å-–õ–æ–≥–∏–∫–∏ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
*   **–ü—Ä–æ–±–ª–µ–º–∞:** –í –ø—Ä–æ–µ–∫—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç **–¥–≤–µ** –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
    1.  `bookings.models.Booking` (Self-proclaimed "Enterprise v2")
    2.  `hotels.models.Booking` (Legacy: `tb_bookings`)
*   **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫:** –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—É, –∫–∞–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ —è–≤–ª—è–µ—Ç—Å—è "–º–∞—Å—Ç–µ—Ä–æ–º". –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–∏—à—É—Ç—Å—è –≤ –æ–¥–Ω—É, –∞ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –¥—Ä—É–≥–æ–π ‚Äî –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç —Å–ª–æ–º–∞–Ω. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ Legacy –º–æ–¥–µ–ª–µ–π.

### 4. –ù–µ–ø–æ–ª–Ω–∞—è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å E-mehmon (–≠–¢–ê–ü 1 –∏ 4)
*   **–ó–∞—è–≤–ª–µ–Ω–æ:** –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: `POST /booking/create` (—Å–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏), `Webhook` (—Å—Ç–∞—Ç—É—Å—ã), `GET /foreigner/status` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–∑—ã).
*   **–ü–æ —Ñ–∞–∫—Ç—É:**
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `check_person_info` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Å–ø–æ—Ä—Ç–∞), –Ω–æ –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ **Mock-–¥–∞–Ω–Ω—ã—Ö** (–∑–∞–≥–ª—É—à–µ–∫) –¥–ª—è `DEBUG=True`.
    *   –ú–µ—Ç–æ–¥—ã `sync_hotel_availability` –∏ `sync_booking_status` –≤ `hotels/services/emehmon.py` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç **–ø—É—Å—Ç—ã–µ –∑–∞–≥–ª—É—à–∫–∏** (`return {'success': True, 'data': []}`).
    *   –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ E-mehmon –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—Ä–æ–Ω–∏ (`POST /api/v1/booking/create`) –≤ –∫–æ–¥–µ **–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç**.
*   **–†–∏—Å–∫:** –ü—Ä–æ–µ–∫—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Å—Ç–µ–π.

### 5. –ü–ª–∞—Ç–µ–∂–Ω—ã–π –ú–æ–¥—É–ª—å (–≠–¢–ê–ü 1.8)
*   **–ó–∞—è–≤–ª–µ–Ω–æ:** –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ VIA/Yagona —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–æ–≤.
*   **–ü–æ —Ñ–∞–∫—Ç—É:** –ï—Å—Ç—å —Ñ–∞–π–ª—ã `test_payment_integration.py` –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∫–ª–∞—Å—Å `YagonaBillingService`, –Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã —ç—Ç–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `hotels/views_api.py`. –ö–æ–¥ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏", –Ω–æ –Ω–µ "—Ä–∞–±–æ—Ç–∞—é—â–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è".

---

## –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ –≠–¢–ê–ü–ê–ú

### –≠–¢–ê–ü 2 ‚Äî –†–û–õ–ò –ò –ü–†–ê–í–ê
*   **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**
*   **–ê–Ω–∞–ª–∏–∑:** –ú–æ–¥–µ–ª—å `User` (`tb_users`) —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `role` —Å –Ω—É–∂–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ (`vendor`, `hotel_admin`, `moderator` –∏ —Ç.–¥.).
*   **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫:** –ù–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Permissions (RBAC) –≤ Views. –ß–∞—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞–º–∏ `@login_required` –∏–ª–∏ –ø—Ä–æ—Å—Ç—ã–º `if user.role == ...`, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—è–∑–≤–∏–º–æ—Å—Ç—è–º (IDOR), –∫–æ–≥–¥–∞ Vendor A –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–µ–ª—å Vendor B.

### –≠–¢–ê–ü 3 ‚Äî –°–£–©–ù–û–°–¢–ò
*   **–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**
*   **–ê–Ω–∞–ª–∏–∑:** –ú–æ–¥–µ–ª–∏ `User`, `Vendor`, `Booking`, `Ticket` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç.
*   **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —è–≤–Ω–∞—è –º–æ–¥–µ–ª—å `Profile` (–¥–∞–Ω–Ω—ã–µ —Å–º–µ—à–∞–Ω—ã –≤ `User`). –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –æ—Ç–µ–ª–µ–π (`Hotel` vs Legacy tables).

### –≠–¢–ê–ü 7 ‚Äî MAINTENANCE MODE
*   **–°—Ç–∞—Ç—É—Å:** ‚ùå **–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**
*   **–ê–Ω–∞–ª–∏–∑:** Middleware –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ 503 –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ñ–ª–∞–≥–∞ –≤ Redis/Config –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (Plan of Action)

1.  **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
    *   –î–æ–±–∞–≤–∏—Ç—å `Redis` –∏ `Celery` –≤ —Å—Ç–µ–∫.
    *   –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `Celery Worker` –∏ `Celery Beat`.
    *   –ó–∞–º–µ–Ω–∏—Ç—å MySQL –Ω–∞ PostgreSQL (–∫–∞–∫ –∑–∞—è–≤–ª–µ–Ω–æ) –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ JSONB –∏ –ª—É—á—à–µ–π —Ä–∞–±–æ—Ç—ã —Å –≥–µ–æ-–¥–∞–Ω–Ω—ã–º–∏ (PostGIS).

2.  **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**
    *   –£–¥–∞–ª–∏—Ç—å `hotels.models.Booking` (legacy).
    *   –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –Ω–∞ `bookings.models.Booking`.
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª `post_save` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤ Celery: `send_booking_to_emehmon_task`.

3.  **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è E-mehmon:**
    *   –£–±—Ä–∞—Ç—å –∑–∞–≥–ª—É—à–∫–∏ (mock) –∏–∑ `hotels/services/emehmon.py`.
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π `POST` –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Å—Ç—è.
    *   –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–µ–º Webhook'–æ–≤.

4.  **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:**
    *   –í—ã–Ω–µ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–∫—É Email, –≥–µ–Ω–µ—Ä–∞—Ü–∏—é PDF –±–∏–ª–µ—Ç–æ–≤ –∏ –∑–∞–ø—Ä–æ—Å—ã –∫ E-mehmon –≤ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ Celery.

**–ò—Ç–æ–≥:** –ü—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç–∞–¥–∏–∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞ (MVP), –∏–º–∏—Ç–∏—Ä—É—é—â–µ–≥–æ Enterprise –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
